<?phprequire_once(WCF_DIR.'lib/data/clique/CliqueEditor.class.php');/** * @author	$foo * @license	>Creative Commons Namensnennung 3.0 Deutschland License * @package	de.foo.clique */class CliqueMenuItems {	/**	 * Get menu items	 *	 */	public static function setActiveMenuItem($menuItem) {		$cliqueMenuItemsCache = self::getMenuItemCache();		foreach ($cliqueMenuItemsCache as $cliqueMenuItems) {			$explodeMenuItem = explode(".",$cliqueMenuItems['menuItem']);                                                          			if(!self::checkFunctionEnable(end($explodeMenuItem), $menuItem)) continue;			if(!empty($cliqueMenuItems['permissions'])) {				if(CliqueEditor::getCliquePermission($cliqueMenuItems['permissions']) || WCF::getUser()->getPermission($cliqueMenuItems['groupoption'])) {					if (in_array($menuItem, $cliqueMenuItems)) {						$cliqueMenuItems['active'] = 1;						$menuItems[] = $cliqueMenuItems;					}					else {						$cliqueMenuItems['active'] = 0;						$menuItems[] = $cliqueMenuItems;					}				}			}			else {				if (in_array($menuItem, $cliqueMenuItems) || WCF::getUser()->getPermission($cliqueMenuItems['groupoption'])) {					$cliqueMenuItems['active'] = 1;					$menuItems[] = $cliqueMenuItems;				}				else {					$cliqueMenuItems['active'] = 0;					$menuItems[] = $cliqueMenuItems;				}			}		}		WCF::getTPL()->assign(array(			'cliqueMenuItems' => $menuItems		));	}	/**	 * Check if the function is enable	 *	 */	public static function checkFunctionEnable($function, $menuItem) {        $cliqueID = CliqueEditor::getCurrentCliqueID();	   	   	   	   	   		$sql = "SELECT ".$function."Enable						FROM wcf".WCF_N."_clique						WHERE cliqueID = ".$cliqueID;		$functionEnable = WCF::getDB()->getFirstRow($sql, Database::SQL_ASSOC);        $explodeMenueItem = explode(".",$menuItem);		if(end($explodeMenueItem) == $function && empty($functionEnable[$function.'Enable'])) {			throw new IllegalLinkException();		}		return $functionEnable[$function.'Enable'];	}	/**	 * Get menu items	 *	 */	public static function getMenuItemCache() {		WCF::getCache()->addResource('cliquePageMenu-'.PACKAGE_ID, WCF_DIR.'cache/cache.cliquePageMenu-'.PACKAGE_ID.'.php', WCF_DIR.'lib/system/cache/CacheBuilderCliquePageMenu.class.php');		$cliqueMenuItems = WCF::getCache()->get('cliquePageMenu-'.PACKAGE_ID);        return $cliqueMenuItems;                                        	}}?>